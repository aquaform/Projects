### Публикация пакета

До того, как мы непосредственно приступим к написанию самих игр, нам нужно подготовить npm-пакет и научиться его публиковать. Также мы сразу подключим к нашему проекту `babel`, чтобы воспользоваться всеми возможностями современного js.

На этом этапе наш пакет будет представлять из себя программу, которая после установки становится доступной по имени `brain-games` и при вызове выводит на экран приветствие.

Чтобы запустить тривиальный js-проект на выполнение, необходимо выполнить много подготовительных действий. В этом шаге мы даем конкретную инструкцию в стиле "скопируй и вставь". Это вынужденная мера, иначе пришлось бы очень долго погружаться в инструментарий. Если вам будет что-то непонятно, вы всегда можете задать вопрос в общем обсуждении проекта в самом низу страницы.

Также вступите в канал _#hexlet-projects_ в [чате Хекслета](http://slack-ru.hexlet.io/) – здесь вы сможете обсудить любые вопросы по проекту.

#### Инициализация пакета

##### Ссылки

  * [Запуск на выполнение и переменная окружения PATH](https://habrahabr.ru/post/105495/)
  * [Как я смогу запускать программы на выполнение?](https://www.sao.ru/hq/sts/linux/doc/lnag/3.html#run_program)
  * [Шебанг](https://goo.gl/p7IdS8)
  * [Шпаргалка по npm](https://habrahabr.ru/post/133363/)

##### Задачи

  1. Инициализируйте ваш npm-пакет внутри папки с проектом, используя команду `npm init`.
  2. Создайте в папке `src/bin` исполняемый файл `brain-games.js`. Такие файлы еще называют "бинарниками".
  3. Сделайте так, чтобы запуск `src/bin/brain-games.js` выводил на экран строку:
    
    $ src/bin/brain-games.js Welcome to the Brain Games! 

Такой вариант запуска будет работать только в том случае, если файл `brain-games.js` является исполняемым, и в начале файла прописан шебанг с правильно указанным интерпретатором `node`. Подробнее об этих аспектах нужно прочитать по ссылкам выше.

#### Подключение Babel

Когда мы говорим **JavaScript**, то подразумеваем **Babel** – такова современная реальность. У JS много различных сред исполнения, таких как браузеры (и их различные версии), NodeJS и другие. Все они обладают разными возможностями и разной степенью поддержки фич JS. В общем случае все настолько плохо, что нет никакой гарантии, что код, использующий даже не самые новые фичи языка, будет работать у всех ваших клиентов. Избежать этой проблемы, казалось бы, невозможно: всегда будут появляться новые возможности, и всегда будут старые среды исполнения.

Но однажды эту проблему решили целиком и полностью с помощью Babel. Babel – это программа, которая берет ваш код, использующий последние возможности языка, и транслирует его в другой, который работает так же, но уже не использует эти фичи.

##### Ссылки

  * [Npm Scripts](https://docs.npmjs.com/misc/scripts)
  * [Babel](https://babeljs.io/)
  * [babel-node](https://babeljs.io/docs/usage/cli/#babel-node) – программа для запуска кода из командной строки
  * [Зависимости в npm](https://habrahabr.ru/post/243335/)
  * [Полностью настроенный js пакет](https://github.com/hexlet-boilerplates/nodejs-package) – пример, в котором есть все от и до. В любой непонятной ситуации сравнивайте свое решение с тем, что сделано в этом шаблоне
  * [Используем make](https://www.youtube.com/watch?v=pK9mF5aK05Q)[](http://savefrom.net/?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DpK9mF5aK05Q&utm_source=chameleon&utm_medium=extensions&utm_campaign=link_modifier) – новый взгляд на старый инструмент
  * [Семантическое версионирование](http://semver.org/lang/ru/)

##### Задачи

  1. Создайте `Makefile` с командой `install`, выполняющей `npm install`.
  2. Установите как зависимости следующие пакеты: `babel-cli`, `babel-core`, `babel-preset-env`, `babel-preset-stage-0`.
  3. Не забудьте добавить `node_modules` в `.gitignore`.
  4. Сконфигурируйте `.babelrc` так, чтобы в него вошли два пресета: `env` и `stage-0`.
  5. Создайте в `package.json` npm-скрипт `babel-node`:
    
    "scripts": { "babel-node": "babel-node" } 

Теперь вы можете запускать любой код на выполнение, прогоняя его через бабель:
    
    npm run babel-node -- path/to/file.js 

  6. Добавьте в `Makefile` команду `start`:
    
    npm run babel-node -- src/bin/brain-games.js 

Набирать эту команду руками довольно долго, а `make start` быстро и просто.

#### Публикация в npm-каталог

Код, лежащий на гитхабе – это уже хорошо, но еще недостаточно для того, чтобы другие могли им воспользоваться. Одной из функций **npm** является публикация (обновление) пакетов в **npm**-репозитории. npm Это большой каталог JS-пакетов. Каждый раз, когда вы набираете `npm install <package>`, идет установка именно из этого каталога.

В этой части вашей задачей будет подготовка пакета к публикации и, собственно, сама публикация в общем каталоге.

##### Задачи

  1. Создайте npm-скрипт `build`:
    
     "build": "NODE_ENV=production babel src --out-dir dist --source-maps inline", 

Эта команда натравливает `babel` на папку `src` и указывает ему сложить обработанный код в папку `dist`. Соответственно, эту папку надо добавить в `.gitignore`.

  1. Создайте npm-скрипт (он же и хук) `prepublish`:
    
     "prepublishOnly": "npm run build" 

`prepublishOnly` будет запущен автоматически в момент вызова `npm publish`. Другими словами, перед публикацией пакета в `npm` он будет автоматически транслирован бабелем в старый формат `javascript`, что необходимо для запуска `brain-games` у всех пользователей.

  1. Добавьте созданный `bin` (`brain-games`) в `package.json`:
    
     "bin": { "brain-games": "dist/bin/brain-games.js" } 

Именно благодаря этой строчке пакет будет выполняться как программа `brain-games` после установки. [Подробнее](https://docs.npmjs.com/files/package.json#bin)

Обратите внимание, что используется обработанная бабелем версия.

  1. Создайте директиву `files` в package.json по аналогии с [пакетом-примером](https://github.com/hexlet-boilerplates/nodejs-package).
  2. Опубликуйте пакет в `npm`. Вероятно, вам придется изменить имя пакета (не репозитория!). Имя выберите произвольно.
  3. Добавьте в `Makefile` команду `publish`.
  4. Установите пакет в систему глобально и убедитесь в том, что он работает, запустив `brain-games` в терминале.
